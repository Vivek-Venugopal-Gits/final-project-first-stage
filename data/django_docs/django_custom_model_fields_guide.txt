PURPOSE: This section explains creating custom Field subclasses for non-standard database column types or complex Python objects.
DJANGO VERSION: 6.0
PYTHON VERSION: Not specified
APPLICABILITY:

When built-in fields insufficient.

SECTION: INTRODUCTION
PURPOSE: This section introduces custom fields.
CONCEPT: CUSTOM FIELDS OVERVIEW
Subclass Field for custom database types (e.g., PostgreSQL custom) or serializable Python objects.
CONCEPT: EXAMPLE OBJECT
Hand class for bridge cards.
CODE EXAMPLE:
class Hand:
    def __init__(self, north, east, south, west):
        self.north = north
        self.east = east
        self.south = south
        self.west = west
Use unchanged in models.
SECTION: BACKGROUND THEORY
PURPOSE: This section explains field mechanics.
CONCEPT: DATABASE STORAGE
Fields convert Python objects to/from database formats.
Fit into existing column types.
CONCEPT: WHAT DOES A FIELD CLASS DO?
Field subclasses handle conversion.
Model attributes: Python objects.
Fields stored in Meta on class creation.
SECTION: WRITING A FIELD SUBCLASS
PURPOSE: This section details creating Field subclass.
CONCEPT: PLANNING CUSTOM FIELD
Subclass similar existing Field if possible.
CONCEPT: INITIALIZING NEW FIELD
Separate custom args; pass others to super.
CODE EXAMPLE:
from django.db import models

class HandField(models.Field):
    description = "A hand of cards (bridge style)"

    def __init__(self, *args, **kwargs):
        kwargs["max_length"] = 104
        super().__init__(*args, **kwargs)
Fields accept unused options.
CONCEPT: FIELD DECONSTRUCTION
deconstruct() for migrations: returns (name, path, args, kwargs).
Supplement if custom args.
CODE EXAMPLE:
def deconstruct(self):
    name, path, args, kwargs = super().deconstruct()
    del kwargs["max_length"]
    return name, path, args, kwargs
For new kwargs: include if non-default.
Prefer keyword args.
Test: deconstruct/reconstruct.
CONCEPT: FIELD ATTRIBUTES NOT AFFECTING DATABASE COLUMN DEFINITION
Override non_db_attrs for no-op AlterField.
CODE EXAMPLE:
property
def non_db_attrs(self):
    return super().non_db_attrs + ("separator",)
CONCEPT: CHANGING A CUSTOM FIELDâ€™S BASE CLASS
Cannot change base; create new, retain old for migrations.
CONCEPT: DOCUMENTING YOUR CUSTOM FIELD
Docstring; description class attribute for admindocs.
Interpolate with dict.
SECTION: USEFUL METHODS
PURPOSE: This section lists key methods to override.
CONCEPT: CUSTOM DATABASE TYPES
db_type(connection): return column type.
rel_db_type(connection): for related fields.
CODE EXAMPLE:
def db_type(self, connection):
    return "mytype"

def db_type(self, connection):
    if connection.vendor == "mysql":
        return "datetime"
    else:
        return "timestamp"
Parameters: in init.
None: manual creation.
CONCEPT: CONVERTING VALUES TO PYTHON OBJECTS
from_db_value(value, expression, connection): from DB.
to_python(value): deserialization/forms.
Handle type/string/None.
Raise ValidationError on error.
CODE EXAMPLE:
def from_db_value(self, value, expression, connection):
    if value is None:
        return value
    return parse_hand(value)

def to_python(self, value):
    if isinstance(value, Hand):
        return value
    if value is None:
        return value
    return parse_hand(value)
CONCEPT: CONVERTING PYTHON OBJECTS TO QUERY VALUES
get_prep_value(value): to query.
CODE EXAMPLE:
def get_prep_value(self, value):
    return "".join(["".join(l) for l in (value.north, value.east, value.south, value.west)])
MySQL CHAR/VARCHAR/TEXT: return string.
CONCEPT: CONVERTING QUERY VALUES TO DATABASE VALUES
get_db_prep_value(value, connection, prepared=False)
get_db_prep_save() for save-specific.
CONCEPT: PREPROCESSING VALUES BEFORE SAVING
pre_save(model_instance, add): return value.
Update attribute.
CONCEPT: SPECIFYING THE FORM FIELD FOR A MODEL FIELD
formfield(**kwargs): customize ModelForm field.
Return None to exclude.
CODE EXAMPLE:
def formfield(self, **kwargs):
    some_condition = kwargs.get("some_condition", False)
    if some_condition:
        return None
    defaults = {"form_class": MyFormField}
    defaults.update(kwargs)
    return super().formfield(**defaults)
CONCEPT: EMULATING BUILT-IN FIELD TYPES
get_internal_type(): for SQL commands.
CODE EXAMPLE:
def get_internal_type(self):
    return "CharField"
Unknown: serializer uses, db_type None.
CONCEPT: CONVERTING FIELD DATA FOR SERIALIZATION
value_to_string(obj): via value_from_object(obj)
CODE EXAMPLE:
def value_to_string(self, obj):
    value = self.value_from_object(obj)
    return self.get_prep_value(value)
SECTION: SOME GENERAL ADVICE
PURPOSE: This section provides tips.
CONCEPT: TIPS
Look at django/db/models/fields/.
str() on wrapped class.
SECTION: WRITING A FILEFIELD SUBCLASS
PURPOSE: This section explains FileField subclasses.
CONCEPT: FILEFIELD SUBCLASS
Subclass File; assign to attr_class.
ImageField example.
Cache attributes.
SUMMARY:

Subclass Field or existing.
Handle conversion, deconstruction.
Key methods: db_type, to_python/from_db_value, get_prep_value.
Document, test.