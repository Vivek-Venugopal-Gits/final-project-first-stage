APPLICABILITY: Database function expressions for QuerySet annotations, filters, and aggregations
SECTION: Database Functions Overview: Provides database-native functions as Django expressions for annotations, aggregations, and filters.
CONCEPT: Author Model Example
Uses Author model for text function examples.

CODE:
class Author(models.Model):
    name = models.CharField(max_length=50)
    age = models.PositiveIntegerField(null=True, blank=True)
    alias = models.CharField(max_length=50, null=True, blank=True)
    goesby = models.CharField(max_length=50, null=True, blank=True)
SECTION: Comparison Functions: Handles type conversion, null handling, and value comparison.
COMMAND: Cast()
Cast(expression, output_field)

Forces result type of expression to output_field type.

CODE:
from django.db.models import FloatField
from django.db.models.functions import Cast

Author.objects.create(age=25, name="Margaret Smith")
author = Author.objects.annotate(
    age_as_float=Cast('age', output_field=FloatField())
).get()
print(author.age_as_float)  # 25.0
COMMAND: Coalesce()
Coalesce(*expressions)

Returns first non-null value from list. Empty strings count as values.

CODE:
from django.db.models import Sum
from django.db.models.functions import Coalesce

Author.objects.create(name="Margaret Smith", goesby="Maggie")
author = Author.objects.annotate(
    screen_name=Coalesce('alias', 'goesby', 'name')
).get()
print(author.screen_name)  # Maggie
USAGE GUIDELINES:
USE WHEN:

Handling null values in queries

Providing fallback values

DO NOT USE WHEN:

Mixing text and numeric types

COMMAND: Greatest()
Greatest(*expressions)

Returns greatest value from list.

CODE:
from django.db.models.functions import Greatest

class Blog(models.Model):
    body = models.TextField()
    modified = models.DateTimeField(auto_now=True)

class Comment(models.Model):
    body = models.TextField()
    modified = models.DateTimeField(auto_now=True)
    blog = models.ForeignKey(Blog, on_delete=models.CASCADE)

blog = Blog.objects.create(body="Greatest is the best.")
comment = Comment.objects.create(body="No, Least is better.", blog=blog)
comments = Comment.objects.annotate(
    last_updated=Greatest('modified', 'blog__modified')
)
COMMAND: Least()
Least(*expressions)

Returns least value from list.

SECTION: Date Functions: Extracts and truncates date/time components.
COMMAND: Extract()
Extract(expression, lookup_name, tzinfo=None)

Extracts date component as IntegerField. Supports year, month, day, hour, etc.

CODE:
from datetime import datetime
from django.db.models.functions import Extract

start = datetime(2015, 6, 15)
Experiment.objects.create(
    start_datetime=start, start_date=start.date,
    end_datetime=datetime(2015, 7, 2), end_date=datetime(2015, 7, 2).date()
)
experiment = Experiment.objects.annotate(
    start_year=Extract('start_datetime', 'year')
).get()
experiment.start_year  # 2015
COMMAND: ExtractYear()
ExtractYear(expression, tzinfo=None)

Extracts year component.

Similar subclasses: ExtractIsoYear(), ExtractMonth(), ExtractDay(), ExtractWeekDay(), ExtractIsoWeekDay(), ExtractWeek(), ExtractQuarter(), ExtractHour(), ExtractMinute(), ExtractSecond().

USAGE GUIDELINES:
USE WHEN:

Filtering by date components
Grouping by date parts

DO NOT USE WHEN:

Needing timezone-aware extraction without tzinfo

COMMAND: Now()
Now()

Returns database server's current date/time.

CODE:
from django.db.models.functions import Now

Article.objects.filter(published__lte=Now())
COMMAND: Trunc()
Trunc(expression, kind, output_field=None, tzinfo=None)

Truncates date to significant component (year, month, day, etc.).

CODE:
from django.db.models import Count, DateTimeField
from django.db.models.functions import Trunc

experiments_per_day = Experiment.objects.annotate(
    start_day=Trunc('start_datetime', 'day', output_field=DateTimeField())
).values('start_day').annotate(experiments=Count('id'))
Subclasses: TruncYear(), TruncMonth(), TruncWeek(), TruncQuarter(), TruncDate(), TruncTime(), TruncDay(), TruncHour(), TruncMinute(), TruncSecond().

SECTION: Text Functions: String manipulation and transformation.
COMMAND: Concat()
Concat(*expressions, output_field=None)

Concatenates text expressions.

CODE:
from django.db.models import CharField, Value as V
from django.db.models.functions import Concat

author = Author.objects.annotate(
    screen_name=Concat('name', V(' '), 'goesby', V(','), output_field=CharField())
).get()
print(author.screen_name)  # Margaret Smith, Maggie
COMMAND: Lower()
Lower(expression)

Returns lowercase representation.

CODE:
from django.db.models.functions import Lower

author = Author.objects.annotate(name_lower=Lower('name')).get()
print(author.name_lower)  # margaret smith
COMMAND: Upper()
Upper(expression)

Returns uppercase representation.

COMMAND: Length()
Length(expression)

Returns character count.

CODE:
from django.db.models import CharField
from django.db.models.functions import Length

CharField.register_lookup(Length)
authors = Author.objects.filter(name__length__gt=7)
COMMAND: Substr()
Substr(expression, pos, length=None)

Returns substring starting at 1-indexed position.

CODE:
from django.db.models.functions import Lower, Substr

Author.objects.update(
    alias=Lower(Substr('name', 1, 5))
)
SECTION: Math Functions: Numeric operations and trigonometric functions.
COMMAND: Abs()
Abs(expression)

Returns absolute value.

CODE:
from django.db.models import FloatField
from django.db.models.functions import Abs

FloatField.register_lookup(Abs)
vectors = Vector.objects.filter(x__abs__lt=1, y__abs__lt=1)
Similar math functions: ACos(), ASin(), ATan(), ATan2(), Ceil(), Cos(), Cot(), Degrees(), Exp(), Floor(), Ln(), Log(), Mod(), Pi(), Power(), Radians(), Random(), Round(), Sign(), Sin(), Sqrt(), Tan().

SUMMARY:
Cast/Coalesce/Greatest/Least handle type conversion and nulls
Extract/Trunc provide date component extraction and truncation
Now() returns current database timestamp
Concat/Lower/Upper/Length/Substr for text manipulation
Abs and math functions for numeric operations
Most functions register as field lookups for filtering